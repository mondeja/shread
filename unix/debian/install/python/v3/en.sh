#!/bin/bash
_SCRIPT_FILENAME="$(basename "$0")" source <(printf 'IyEvYmluL2Jhc2gKIyAtKi0gRU5DT0RJTkc6IFVURi04IC0qLQpfTVNHX0VYRUNVVEVEX0FTX1NVUEVSVVNFUj0iVGhpcyBzY3JpcHQgbmVlZHMgdG8gYmUgZXhlY3V0ZWQgYXMgc3VwZXJ1c2VyLiIKX01TR19TRVRUSU5HX1VQX1BZM19FQ09TWVNURU09IlNldHRpbmcgdXAgUHl0aG9uMyBlY29zeXN0ZW0uLi4iCl9NU0dfSU5TVEFMTElOR19CQVNFX1BBQ0tBR0U9Ikluc3RhbGxpbmcgYmFzZSBwYWNrYWdlIgpfTVNHX0ZPVU5EX1BZM19JTlNUQUxMRUQ9IkZvdW5kIFB5dGhvbjMgaW5zdGFsbGVkIGluIHRoZSBzeXN0ZW0iCl9NU0dfQ0hFQ0tJTkdfQURESVRJT05BTF9QWTNfUEFDS0FHRVM9IkNoZWNraW5nIGFkZGl0aW9uYWwgUHl0aG9uIHBhY2thZ2VzLi4uIgpfTVNHX1VQREFUSU5HX0dMT0JBTF9QWTNfTElCUkFSSUVTPSJVcGRhdGluZyBnbG9iYWwgUHl0aG9uMyBsaWJyYXJpZXMuLi4iCmlmICEgKHJldHVybiAwIDI+L2Rldi9udWxsKTsgdGhlbgogIGlmIFtbICQoL3Vzci9iaW4vaWQgLXUpIC1uZSAwIF1dOyB0aGVuCiAgICBwcmludGYgIiVzXG4iICIkX01TR19FWEVDVVRFRF9BU19TVVBFUlVTRVIiID4mMgogICAgZXhpdCAxCiAgZmk7CmZpOwpfVVBHUkFERV9QWTNfR0xPQkFMX0xJQlM9MQpJTkRFTlRfU1RSSU5HPSIiCmZvciBhcmcgaW4gIiRAIjsgZG8KICBjYXNlICRhcmcgaW4KICAgIC0tbm8tdXBncmFkZS1weTMtZ2xvYmFsLWxpYnMpCiAgICBfVVBHUkFERV9QWTNfR0xPQkFMX0xJQlM9MAogICAgc2hpZnQKICAgIDs7CiAgICAtLWluZGVudCkKICAgIHNoaWZ0CiAgICBJTkRFTlRfU1RSSU5HPSQxCiAgICBzaGlmdAogICAgOzsKICBlc2FjCmRvbmUKZnVuY3Rpb24gcHJpbnRJbmRlbnQoKSB7CiAgcHJpbnRmICIlcyIgIiRJTkRFTlRfU1RSSU5HIgp9CmlmIFsgIiQoY29tbWFuZCAtdiBwYWNtYW4pIiA9ICIiIF07IHRoZW4KICBpZiBbICIkX1NDUklQVF9GSUxFTkFNRSIgPSAibWFpbi5zaCIgXTsgdGhlbgogICAgZmlsZXBhdGg9InNyYy91bml4L18vZG93bmxvYWQvcGFjYXB0L21haW4uc2giCiAgICBiYXNoICIkZmlsZXBhdGgiCiAgZWxzZQogICAgdXJsPSJodHRwczovL21vbmRlamEuZ2l0aHViLmlvL3NocmVhZC91bml4L18vZG93bmxvYWQvcGFjYXB0LyRfU0NSSVBUX0ZJTEVOQU1FIgogICAgY3VybCAtc0wgIiR1cmwiIHwgc3VkbyBiYXNoIC0gPiAvZGV2L251bGwKICBmaTsKZmk7CklOU1RBTExBVElPTl9ERVBFTkRFTkNJRVM9KAogICJkZWJjb25mLXV0aWxzIgogICJjdXJsIgopCmZvciBERVAgaW4gIiR7SU5TVEFMTEFUSU9OX0RFUEVOREVOQ0lFU1tAXX0iOyBkbwogIGlmIFtbICIkKHBhY21hbiAtUWkgIiRERVAiIDI+IC9kZXYvbnVsbCB8IGdyZXAgU3RhdHVzKSIgIT0gIlN0YXR1czogaW5zdGFsbCBvayBpbnN0YWxsZWQiIF1dOyB0aGVuCiAgICBzdWRvIHBhY21hbiAtUyAiJERFUCIgPiAvZGV2L251bGwgfHwgZXhpdCAkPwogIGZpOwpkb25lOwppZiBbICIkKGNvbW1hbmQgLXYgZGViY29uZi1nZXQtc2VsZWN0aW9ucykiICE9ICIiIF07IHRoZW4KICBfT1JJR0lOQUxfREVCQ09ORl9GUk9OVEVORD0kKAogICAgc3VkbyBkZWJjb25mLWdldC1zZWxlY3Rpb25zIHwgXAogICAgZ3JlcCBkZWJjb25mL2Zyb250ZW5kIHwgXAogICAgYXdrICd7cHJpbnQgJDR9JykKICBzdWRvIHNoIC1jICJlY2hvICdkZWJjb25mIGRlYmNvbmYvZnJvbnRlbmQgc2VsZWN0IE5vbmludGVyYWN0aXZlJyB8IGRlYmNvbmYtc2V0LXNlbGVjdGlvbnMiCmZpOwppZiBbIC16ICIkVU5JWF9ESVNUUk8iIF0gfHwgWyAteiAiJFVOSVhfRElTVFJPX1ZFUlNJT05fTlVNQkVSX01BSk9SIiBdOyB0aGVuCiAgc291cmNlIDwoY3VybCAtc0wgaHR0cHM6Ly9tb25kZWphLmdpdGh1Yi5pby9zaHJlYWQvdW5peC9fL3V0aWwvZ2V0LWRpc3Ryby9lbi5zaCkKZmk7CmZ1bmN0aW9uIGluc3RhbGxNYWluUHl0aG9uM0FwdFBhY2thZ2UgewogIHByaW50SW5kZW50CiAgUFkzX0JJTkFSWV9GSUxFUEFUSD0iJChjb21tYW5kIC12IHB5dGhvbjMpIgogIGlmIFsgIiRQWTNfQklOQVJZX0ZJTEVQQVRIIiA9ICIiIF07IHRoZW4KICAgIF9QWVRIT05fU1RBQkxFX1BBQ0tBR0VfVkVSU0lPTj0kKAogICAgICBhcHQtY2FjaGUgcG9saWN5IHB5dGhvbjMtZGV2IHwgZ3JlcCAtUG8gJyhcZCtcLikrXGQrJyB8IGhlYWQgLW4gMSkKICAgIHByaW50ZiAiICAlcyIgIiRfTVNHX0lOU1RBTExJTkdfQkFTRV9QQUNLQUdFIgogICAgaWYgWyAiJF9QWVRIT05fU1RBQkxFX1BBQ0tBR0VfVkVSU0lPTiIgIT0gIiIgXTsgdGhlbgogIAkgIHByaW50ZiAiICh2JXMpIiAiJF9QWVRIT05fU1RBQkxFX1BBQ0tBR0VfVkVSU0lPTiIKICAgIGZpOwogICAgcHJpbnRmICIuLi4iCiAgCXN1ZG8gYXB0LWdldCBpbnN0YWxsIC15IC1xcXEgcHl0aG9uMy1kZXYgPiAvZGV2L251bGwKICAgIF9QWVRIT05fVkVSU0lPTj0iJCgiJFBZM19CSU5BUllfRklMRVBBVEgiIC0tdmVyc2lvbiB8IGN1dCAtYzctMTIgfCB0ciAtZCAnICcpIgogIGVsc2UKICAgIF9QWVRIT05fVkVSU0lPTj0iJCgiJFBZM19CSU5BUllfRklMRVBBVEgiIC0tdmVyc2lvbiB8IGN1dCAtYzctMTIgfCB0ciAtZCAnICcpIgogIAlwcmludGYgIiAgJXMgKHYlcykiICIkX01TR19GT1VORF9QWTNfSU5TVEFMTEVEIiAiJF9QWVRIT05fVkVSU0lPTiIKICBmaTsKICBwcmludGYgIiBcZVs5Mm1ceEUyXHg5Q1x4OTRcZVszOW1cbiIKfQpmdW5jdGlvbiBkaXNjb3Zlckluc3RhbGxhdGlvbkFwdFBhY2thZ2VzIHsKICBJTlNUQUxMQVRJT05fUEFDS0FHRVM9KAogICAgInB5dGhvbjMtZGV2IgogICAgInB5dGhvbjMtcGlwIgogICAgInB5dGhvbjMtc2V0dXB0b29scyIKICAgICJweXRob24zLXRlc3RyZXNvdXJjZXMiCiAgICAibGlieG1sMi11dGlscyIKICAgICJweXRob24tbHhtbCIKICAgICJweXRob24zLWx4bWwiCiAgICAicHl0aG9uLW51bXB5IgogICAgInB5dGhvbjMtbnVtcHkiCiAgKQogIGlmIFsgIiRVTklYX0RJU1RSTyIgPSAidWJ1bnR1IiBdOyB0aGVuCiAgICBpZiBbICIkVU5JWF9ESVNUUk9fVkVSU0lPTl9OVU1CRVJfTUFKT1IiIC1nZSAxOCBdOyB0aGVuCiAgICAgIElOU1RBTExBVElPTl9QQUNLQUdFUys9KAogICAgICAgICJweXRob24zLWRpc3R1dGlscyIKICAgICAgKQogICAgZmk7CiAgICBpZiBbICIkVU5JWF9ESVNUUk9fVkVSU0lPTl9OVU1CRVJfTUFKT1IiIC1sdCAyMCBdOyB0aGVuCiAgICAgIElOU1RBTExBVElPTl9QQUNLQUdFUys9KAogICAgICAgICJweXRob24tcGlwIgogICAgICAgICJweXRob24tZGV2IgogICAgICApCiAgICBlbHNlCiAgICAgIElOU1RBTExBVElPTl9QQUNLQUdFUys9KAogICAgICAgICJweXRob24tZGV2LWlzLXB5dGhvbjIiCiAgICAgICkKICAgIGZpOwogIGZpOwp9CmZ1bmN0aW9uIGluc3RhbGxQeXRob25BZGRpdGlvbmFsQXB0UGFja2FnZXMgewogIHByaW50SW5kZW50CiAgcHJpbnRmICIgICVzXG4iICIkX01TR19DSEVDS0lOR19BRERJVElPTkFMX1BZM19QQUNLQUdFUyIKICBmb3IgREVQIGluICIke0lOU1RBTExBVElPTl9QQUNLQUdFU1tAXX0iOyBkbwogICAgcHJpbnRJbmRlbnQKICAgIHByaW50ZiAiICAgICVzIiAiJERFUCIKICAgIGlmIFtbICIkKHN1ZG8gcGFjbWFuIC1RaSAiJERFUCIgMj4gL2Rldi9udWxsIHwgZ3JlcCBTdGF0dXMpIiAhPSAiU3RhdHVzOiBpbnN0YWxsIG9rIGluc3RhbGxlZCIgXV07IHRoZW4KICAgICAgc3VkbyBwYWNtYW4gLVMgIiRERVAiID4gL2Rldi9udWxsIHx8IGV4aXQgJD8KICAgIGZpOwogICAgX0RFUF9WRVJTSU9OPSQoYXB0LWNhY2hlIHBvbGljeSAiJERFUCIgfCBncmVwIC1QbyAiKFxkK1wuKStcZCsiIHwgaGVhZCAtbiAxKQogICAgaWYgWyAiJF9ERVBfVkVSU0lPTiIgIT0gIiIgXTsgdGhlbgogICAgICBwcmludGYgIiAodiVzKSIgIiRfREVQX1ZFUlNJT04iCiAgICBmaTsKICAgIHByaW50ZiAiIFxlWzkybVx4RTJceDlDXHg5NFxlWzM5bVxuIgogIGRvbmUKfQpmdW5jdGlvbiBjb25maWd1cmVQSVAgewogIFVTRVJfSE9NRT0iJChnZXRlbnQgcGFzc3dkICIkU1VET19VU0VSIiB8IGN1dCAtZDogLWY2KSIKICBpZiBbIC1kICIkSE9NRS8uY2FjaGUvcGlwLyIgXTsgdGhlbgogICAgX1BJUF9DQUNIRV9GSUxFUEFUSD0iJFVTRVJfSE9NRS8uY2FjaGUvcGlwLyIKICAgIGlmIFsgLWYgIiRfUElQX0NBQ0hFX0ZJTEVQQVRIIiBdOyB0aGVuCiAgICAgIHN1ZG8gY2hvd24gLVIgIiRTVURPX1VTRVIiICIkX1BJUF9DQUNIRV9GSUxFUEFUSCIKICAgIGZpOwogIGZpOwogIGlmIFsgIiQoY29tbWFuZCAtdiBweXRob24yKSIgIT0gIiIgXTsgdGhlbgogICAgc3VkbyBweXRob24yIC1tIHBpcCBpbnN0YWxsIC1xcSBwaXA9PTIwLjAuMgogIGZpOwp9CmZ1bmN0aW9uIHVwZ3JhZGVHbG9iYWxMaWJyYXJpZXMgewogIGlmIFsgJF9VUEdSQURFX1BZM19HTE9CQUxfTElCUyAtZXEgMSBdOyB0aGVuCiAgICBwcmludEluZGVudAogICAgcHJpbnRmICIgICVzXG4iICIkX01TR19VUERBVElOR19HTE9CQUxfUFkzX0xJQlJBUklFUyIKICAgIEdMT0JBTF9SRUNPTU1FTkRFRF9MSUJSQVJJRVM9KAogICAgICAicGlwIgogICAgICAidmlydHVhbGVudiIKICAgICAgInNldHVwdG9vbHMiCiAgICAgICJ0ZXN0cmVzb3VyY2VzIgogICAgKQogICAgZm9yIExJQiBpbiAiJHtHTE9CQUxfUkVDT01NRU5ERURfTElCUkFSSUVTW0BdfSI7IGRvCiAgICAgIHByaW50SW5kZW50CiAgICAgIHByaW50ZiAiICAgICVzIiAiJExJQiIKICAgICAgX0dFVF9WRVJTSU9OX0VYRUNfU1RSPSIKaW1wb3J0IHN5czsKdHJ5OiBpbXBvcnQgJExJQiBhcyBsOwpleGNlcHQgSW1wb3J0RXJyb3IgYXMgZXJyOiBzeXMuZXhpdCg3NzcpOwpwcmludChsLl9fdmVyc2lvbl9fIGlmIGlzaW5zdGFuY2UobC5fX3ZlcnNpb25fXywgc3RyKSBlbHNlIFwKICAnLicuam9pbihbc3RyKHYpIGZvciB2IGluIGwuX192ZXJzaW9uX19dWzozXSksIGVuZD0nJyk7CiAgIgogICAgICBfTElCX0xPQ0FMX1ZFUlNJT049IiQoIiRQWTNfQklOQVJZX0ZJTEVQQVRIIiAtYyAiJF9HRVRfVkVSU0lPTl9FWEVDX1NUUiIpIgogICAgICBfTElCX0xPQ0FMX1ZFUlNJT05fRVhJVF9DT0RFPSQ/CiAgICAgIGlmIFsgJF9MSUJfTE9DQUxfVkVSU0lPTl9FWElUX0NPREUgLWVxIDc3NyBdOyB0aGVuCiAgICAgIAlzdWRvIC1IICIkUFkzX0JJTkFSWV9GSUxFUEFUSCIgLW0gcGlwIGluc3RhbGwgLVUgLS1xdWlldCAiJExJQiIKICAgICAgZWxzZQogICAgICAgIHByaW50ZiAiICgiCiAgICAgICAgaWYgWyAiJF9MSUJfTE9DQUxfVkVSU0lPTiIgIT0gIiIgXTsgdGhlbgogICAgICAgICAgcHJpbnRmICJ2JXMiICIkX0xJQl9MT0NBTF9WRVJTSU9OIgogICAgICAgIGZpOwogICAgICAgIF9MSUJfTEFTVF9QWVBJX1ZFUlNJT049JCgKICAgICAgICAgIHhtbGxpbnQgLS1odG1sIC0teHBhdGggIi8vYVtsYXN0KCldL3RleHQoKSAiIFwKICAgICAgICAgICAgPChjdXJsIC1zTCAiaHR0cHM6Ly9weXBpLm9yZy9zaW1wbGUvJExJQi8iKSB8IFwKICAgICAgICAgICAgZ3JlcCAtUG8gIihcZCtcLikrXGQrXHcqIikKICAgICAgICAgIGlmIFsgIiRfTElCX0xBU1RfUFlQSV9WRVJTSU9OIiAhPSAiJF9MSUJfTE9DQUxfVkVSU0lPTiIgXTsgdGhlbgogICAgICAgICAgICBpZiBbICIkX0xJQl9MT0NBTF9WRVJTSU9OIiAhPSAiIiBdOyB0aGVuCiAgICAgICAgICAgICAgcHJpbnRmICIgLT4gIgogICAgICAgICAgICBmaTsKICAgICAgICAgICAgcHJpbnRmICJ2JXMpLi4uIiAiJF9MSUJfTEFTVF9QWVBJX1ZFUlNJT04iCiAgICAgICAgICAgIF9saWJfZXF1YWxfdmVyc2lvbj0iJExJQj09JF9MSUJfTEFTVF9QWVBJX1ZFUlNJT04iCiAgICAgICAgICAgIHN1ZG8gLUggIiRQWTNfQklOQVJZX0ZJTEVQQVRIIiAtbSBwaXAgaW5zdGFsbCAtVSAtcXEgIiRfbGliX2VxdWFsX3ZlcnNpb24iCiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHByaW50ZiAiKSIKICAgICAgICAgIGZpOwogICAgICBmaTsKICAgICAgcHJpbnRmICIgXGVbOTJtXHhFMlx4OUNceDk0XGVbMzltXG4iCiAgICBkb25lCiAgZmk7Cn0KZnVuY3Rpb24gbWFpbiB7CiAgcHJpbnRJbmRlbnQKICBwcmludGYgIiVzXG4iICIkX01TR19TRVRUSU5HX1VQX1BZM19FQ09TWVNURU0iCiAgaW5zdGFsbE1haW5QeXRob24zQXB0UGFja2FnZQogIGRpc2NvdmVySW5zdGFsbGF0aW9uQXB0UGFja2FnZXMKICBpbnN0YWxsUHl0aG9uQWRkaXRpb25hbEFwdFBhY2thZ2VzCiAgY29uZmlndXJlUElQCiAgdXBncmFkZUdsb2JhbExpYnJhcmllcwp9CmZ1bmN0aW9uIGV4cG9ydFZhcmlhYmxlcyB7CiAgZGlzY292ZXJJbnN0YWxsYXRpb25BcHRQYWNrYWdlcwogIGV4cG9ydCBJTlNUQUxMQVRJT05fUEFDS0FHRVMKfQppZiAocmV0dXJuIDAgMj4vZGV2L251bGwpOyB0aGVuCiAgZXhwb3J0VmFyaWFibGVzCmVsc2UKICBtYWluCmZpOwppZiBbICIkKGNvbW1hbmQgLXYgZGViY29uZi1nZXQtc2VsZWN0aW9ucykiICE9ICIiIF07IHRoZW4KICBzdWRvIHNoIC1jICJlY2hvICdkZWJjb25mIGRlYmNvbmYvZnJvbnRlbmQgc2VsZWN0ICRfT1JJR0lOQUxfREVCQ09ORl9GUk9OVEVORCcgfCBkZWJjb25mLXNldC1zZWxlY3Rpb25zIgpmaTsK' | base64 -d)
