#!/bin/bash
source <(printf 'IyEvYmluL2Jhc2gKIyAtKi0gRU5DT0RJTkc6IFVURi04IC0qLQpfTVNHX0VYRUNVVEVEX0FTX1NVUEVSVVNFUj0iRXN0ZSBzY3JpcHQgbmVjZXNpdGEgc2VyIGVqZWN1dGFkbyBjb21vIHN1cGVydXN1YXJpby4iCl9NU0dfU0VUVElOR19VUF9QWTNfRUNPU1lTVEVNPSJDb25maWd1cmFuZG8gZWNvc2lzdGVtYSBQeXRob24zLi4uIgpfTVNHX0lOU1RBTExJTkdfQkFTRV9QQUNLQUdFPSJJbnN0YWxhbmRvIHBhcXVldGUgYmFzZSIKX01TR19GT1VORF9QWTNfSU5TVEFMTEVEPSJFbmNvbnRyYWRvIFB5dGhvbjMgaW5zdGFsYWRvIGVuIGVsIHNpc3RlbWEiCl9NU0dfQ0hFQ0tJTkdfQURESVRJT05BTF9QWTNfUEFDS0FHRVM9IkNvbXByb2JhbmRvIHBhcXVldGVzIGRlIFB5dGhvbiBhZGljaW9uYWxlcy4uLiIKX01TR19VUERBVElOR19HTE9CQUxfUFkzX0xJQlJBUklFUz0iQWN0dWFsaXphbmRvIGJpYmxpb3RlY2FzIGRlIFB5dGhvbjMgZ2xvYmFsZXMuLi4iCmlmIFtbICRfID0gJDAgXV07IHRoZW4KICBpZiBbWyAkKC91c3IvYmluL2lkIC11KSAtbmUgMCBdXTsgdGhlbgogICAgcHJpbnRmICIlc1xuIiAiJF9NU0dfRVhFQ1VURURfQVNfU1VQRVJVU0VSIiA+JjIKICAgIGV4aXQgMQogIGZpOwpmaTsKX1VQR1JBREVfUFkzX0dMT0JBTF9MSUJTPTEKSU5ERU5UX1NUUklORz0iIgpmb3IgYXJnIGluICIkQCI7IGRvCiAgY2FzZSAkYXJnIGluCiAgICAtLW5vLXVwZ3JhZGUtcHkzLWdsb2JhbC1saWJzKQogICAgX1VQR1JBREVfUFkzX0dMT0JBTF9MSUJTPTAKICAgIHNoaWZ0CiAgICA7OwogICAgLS1pbmRlbnQpCiAgICBzaGlmdAogICAgSU5ERU5UX1NUUklORz0kMQogICAgc2hpZnQKICAgIDs7CiAgZXNhYwpkb25lCmZ1bmN0aW9uIHByaW50UHJlcGVuZGVkU3Rkb3V0KCkgewogIHByaW50ZiAiJXMiICIkSU5ERU5UX1NUUklORyIKfQppZiBbWyAiJChzdWRvIGRwa2cgLXMgZGViY29uZi11dGlscyAyPiAvZGV2L251bGwgfCBncmVwIFN0YXR1cykiICE9ICJTdGF0dXM6IGluc3RhbGwgb2sgaW5zdGFsbGVkIiBdXTsgdGhlbgogIHN1ZG8gYXB0LWdldCBpbnN0YWxsIC15IC1xcXEgZGViY29uZi11dGlscyA+IC9kZXYvbnVsbApmaTsKaWYgWyAiJChjb21tYW5kIC12IGRlYmNvbmYtZ2V0LXNlbGVjdGlvbnMpIiAhPSAiIiBdOyB0aGVuCiAgX09SSUdJTkFMX0RFQkNPTkZfRlJPTlRFTkQ9JCgKICAgIHN1ZG8gZGViY29uZi1nZXQtc2VsZWN0aW9ucyB8IFwKICAgIGdyZXAgZGViY29uZi9mcm9udGVuZCB8IFwKICAgIGF3ayAne3ByaW50ICQ0fScpCiAgc3VkbyBzaCAtYyAiZWNobyAnZGViY29uZiBkZWJjb25mL2Zyb250ZW5kIHNlbGVjdCBOb25pbnRlcmFjdGl2ZScgfCBkZWJjb25mLXNldC1zZWxlY3Rpb25zIgpmaTsKaWYgWyAteiAiJFVOSVhfRElTVFJPIiBdOyB0aGVuCiAgaWYgW1sgIiQoc3VkbyBkcGtnIC1zIGN1cmwgMj4gL2Rldi9udWxsIHwgZ3JlcCBTdGF0dXMpIiAhPSAiU3RhdHVzOiBpbnN0YWxsIG9rIGluc3RhbGxlZCIgXV07IHRoZW4KICAgIHN1ZG8gYXB0LWdldCBpbnN0YWxsIC15IC1xcXEgY3VybCA+IC9kZXYvbnVsbAogIGZpOwogIHNvdXJjZSA8KGN1cmwgLXNMIGh0dHBzOi8vbW9uZGVqYS5naXRodWIuaW8vc2hyZWFkL3VuaXgvXy91dGlsL2dldC1kaXN0cm8vZW4uc2gpCmZpOwplY2hvICIkVU5JWF9ESVNUUk9fVkVSU0lPTl9OQU1FIgpmdW5jdGlvbiBpbnN0YWxsTWFpblB5dGhvbjNBcHRQYWNrYWdlIHsKICBwcmludFByZXBlbmRlZFN0ZG91dAogIFBZM19CSU5BUllfRklMRVBBVEg9IiQoY29tbWFuZCAtdiBweXRob24zKSIKICBpZiBbICIkUFkzX0JJTkFSWV9GSUxFUEFUSCIgPSAiIiBdOyB0aGVuCiAgICBfUFlUSE9OX1NUQUJMRV9QQUNLQUdFX1ZFUlNJT049JCgKICAgICAgYXB0LWNhY2hlIHBvbGljeSBweXRob24zLWRldiB8IGdyZXAgLVBvICcoXGQrXC4pK1xkKycgfCBoZWFkIC1uIDEpCiAgICBwcmludGYgIiAgJXMiICIkX01TR19JTlNUQUxMSU5HX0JBU0VfUEFDS0FHRSIKICAgIGlmIFsgIiRfUFlUSE9OX1NUQUJMRV9QQUNLQUdFX1ZFUlNJT04iICE9ICIiIF07IHRoZW4KICAJICBwcmludGYgIiAodiVzKSIgIiRfUFlUSE9OX1NUQUJMRV9QQUNLQUdFX1ZFUlNJT04iCiAgICBmaTsKICAgIHByaW50ZiAiLi4uIgogIAlzdWRvIGFwdC1nZXQgaW5zdGFsbCAteSAtcXFxIHB5dGhvbjMtZGV2ID4gL2Rldi9udWxsCiAgICBfUFlUSE9OX1ZFUlNJT049IiQoIiRQWTNfQklOQVJZX0ZJTEVQQVRIIiAtLXZlcnNpb24gfCBjdXQgLWM3LTEyIHwgdHIgLWQgJyAnKSIKICBlbHNlCiAgICBfUFlUSE9OX1ZFUlNJT049IiQoIiRQWTNfQklOQVJZX0ZJTEVQQVRIIiAtLXZlcnNpb24gfCBjdXQgLWM3LTEyIHwgdHIgLWQgJyAnKSIKICAJcHJpbnRmICIgICVzICh2JXMpIiAiJF9NU0dfRk9VTkRfUFkzX0lOU1RBTExFRCIgIiRfUFlUSE9OX1ZFUlNJT04iCiAgZmk7CiAgcHJpbnRmICIgXGVbOTJtXHhFMlx4OUNceDk0XGVbMzltXG4iCn0KZnVuY3Rpb24gZGlzY292ZXJJbnN0YWxsYXRpb25BcHRQYWNrYWdlcyB7CiAgSU5TVEFMTEFUSU9OX1BBQ0tBR0VTPSgKICAgICJweXRob24tZGV2IgogICAgInB5dGhvbjMtZGV2IgogICAgInB5dGhvbjMtcGlwIgogICAgInB5dGhvbjMtc2V0dXB0b29scyIKICAgICJweXRob24zLXRlc3RyZXNvdXJjZXMiCiAgICAibGlieG1sMi11dGlscyIKICAgICJweXRob24tbHhtbCIKICAgICJweXRob24zLWx4bWwiCiAgICAicHl0aG9uLW51bXB5IgogICAgInB5dGhvbjMtbnVtcHkiCiAgKQogIGlmIFsgIiRVTklYX0RJU1RSTyIgPSAidWJ1bnR1IiBdOyB0aGVuCiAgICBpZiBbICIkVU5JWF9ESVNUUk9fVkVSU0lPTl9OVU1CRVJfTUFKT1IiIC1nZSAxOCBdOyB0aGVuCiAgICAgIElOU1RBTExBVElPTl9QQUNLQUdFUys9KAogICAgICAgICJweXRob24zLWRpc3R1dGlscyIKICAgICAgKQogICAgZmk7CiAgICBpZiBbICIkVU5JWF9ESVNUUk9fVkVSU0lPTl9OVU1CRVJfTUFKT1IiIC1sdCAyMCBdOyB0aGVuCiAgICAgIElOU1RBTExBVElPTl9QQUNLQUdFUys9KAogICAgICAgICJweXRob24tcGlwIgogICAgICApCiAgICBmaTsKICBmaTsKfQpmdW5jdGlvbiBpbnN0YWxsUHl0aG9uQWRkaXRpb25hbEFwdFBhY2thZ2VzIHsKICBwcmludFByZXBlbmRlZFN0ZG91dAogIHByaW50ZiAiICAlc1xuIiAiJF9NU0dfQ0hFQ0tJTkdfQURESVRJT05BTF9QWTNfUEFDS0FHRVMiCiAgZm9yIERFUCBpbiAiJHtJTlNUQUxMQVRJT05fUEFDS0FHRVNbQF19IjsgZG8KICAgIHByaW50UHJlcGVuZGVkU3Rkb3V0CiAgICBwcmludGYgIiAgICAlcyIgIiRERVAiCiAgICBpZiBbWyAiJChkcGtnIC1zICIkREVQIiAyPiAvZGV2L251bGwgfCBncmVwIFN0YXR1cykiICE9ICJTdGF0dXM6IGluc3RhbGwgb2sgaW5zdGFsbGVkIiBdXTsgdGhlbgogICAgICBzdWRvIGFwdC1nZXQgaW5zdGFsbCAteSAtcXFxICIkREVQIiA+IC9kZXYvbnVsbCB8fCBleGl0ICQ/CiAgICBmaTsKICAgIF9ERVBfVkVSU0lPTj0kKGFwdC1jYWNoZSBwb2xpY3kgIiRERVAiIHwgZ3JlcCAtUG8gIihcZCtcLikrXGQrIiB8IGhlYWQgLW4gMSkKICAgIGlmIFsgIiRfREVQX1ZFUlNJT04iICE9ICIiIF07IHRoZW4KICAgICAgcHJpbnRmICIgKHYlcykiICIkX0RFUF9WRVJTSU9OIgogICAgZmk7CiAgICBwcmludGYgIiBcZVs5Mm1ceEUyXHg5Q1x4OTRcZVszOW1cbiIKICBkb25lCn0KZnVuY3Rpb24gY29uZmlndXJlUElQIHsKICBVU0VSX0hPTUU9IiQoZ2V0ZW50IHBhc3N3ZCAiJFNVRE9fVVNFUiIgfCBjdXQgLWQ6IC1mNikiCiAgaWYgWyAtZCAiJEhPTUUvLmNhY2hlL3BpcC8iIF07IHRoZW4KICAgIF9QSVBfQ0FDSEVfRklMRVBBVEg9IiRVU0VSX0hPTUUvLmNhY2hlL3BpcC8iCiAgICBpZiBbIC1mICIkX1BJUF9DQUNIRV9GSUxFUEFUSCIgXTsgdGhlbgogICAgICBzdWRvIGNob3duIC1SICIkU1VET19VU0VSIiAiJF9QSVBfQ0FDSEVfRklMRVBBVEgiCiAgICBmaTsKICBmaTsKICBpZiBbICIkKGNvbW1hbmQgLXYgcHl0aG9uMikiICE9ICIiIF07IHRoZW4KICAgIHN1ZG8gcHl0aG9uMiAtbSBwaXAgaW5zdGFsbCAtcXEgcGlwPT0yMC4wLjIKICBmaTsKfQpmdW5jdGlvbiB1cGdyYWRlR2xvYmFsTGlicmFyaWVzIHsKICBpZiBbICRfVVBHUkFERV9QWTNfR0xPQkFMX0xJQlMgLWVxIDEgXTsgdGhlbgogICAgcHJpbnRQcmVwZW5kZWRTdGRvdXQKICAgIHByaW50ZiAiICAlc1xuIiAiJF9NU0dfVVBEQVRJTkdfR0xPQkFMX1BZM19MSUJSQVJJRVMiCiAgICBHTE9CQUxfUkVDT01NRU5ERURfTElCUkFSSUVTPSgKICAgICAgInBpcCIKICAgICAgInZpcnR1YWxlbnYiCiAgICAgICJzZXR1cHRvb2xzIgogICAgICAidGVzdHJlc291cmNlcyIKICAgICkKICAgIGZvciBMSUIgaW4gIiR7R0xPQkFMX1JFQ09NTUVOREVEX0xJQlJBUklFU1tAXX0iOyBkbwogICAgICBwcmludFByZXBlbmRlZFN0ZG91dAogICAgICBwcmludGYgIiAgICAlcyIgIiRMSUIiCiAgICAgIF9HRVRfVkVSU0lPTl9FWEVDX1NUUj0iCiAgaW1wb3J0IHN5czsKICB0cnk6IGltcG9ydCAkTElCIGFzIGw7CiAgZXhjZXB0IEltcG9ydEVycm9yIGFzIGVycjogc3lzLmV4aXQoNzc3KTsKICBwcmludChsLl9fdmVyc2lvbl9fIGlmIGlzaW5zdGFuY2UobC5fX3ZlcnNpb25fXywgc3RyKSBlbHNlIFwKICAgICcuJy5qb2luKFtzdHIodikgZm9yIHYgaW4gbC5fX3ZlcnNpb25fX11bOjNdKSwgZW5kPScnKTsKICAiCiAgICAgIF9MSUJfTE9DQUxfVkVSU0lPTj0iJCgiJFBZM19CSU5BUllfRklMRVBBVEgiIC1jICIkX0dFVF9WRVJTSU9OX0VYRUNfU1RSIikiCiAgICAgIF9MSUJfTE9DQUxfVkVSU0lPTl9FWElUX0NPREU9JD8KICAgICAgaWYgWyAkX0xJQl9MT0NBTF9WRVJTSU9OX0VYSVRfQ09ERSAtZXEgNzc3IF07IHRoZW4KICAgICAgCXN1ZG8gLUggIiRQWTNfQklOQVJZX0ZJTEVQQVRIIiAtbSBwaXAgaW5zdGFsbCAtVSAtLXF1aWV0ICIkTElCIgogICAgICBlbHNlCiAgICAgICAgcHJpbnRmICIgKCIKICAgICAgICBpZiBbICIkX0xJQl9MT0NBTF9WRVJTSU9OIiAhPSAiIiBdOyB0aGVuCiAgICAgICAgICBwcmludGYgInYlcyIgIiRfTElCX0xPQ0FMX1ZFUlNJT04iCiAgICAgICAgZmk7CiAgICAgICAgX0xJQl9MQVNUX1BZUElfVkVSU0lPTj0kKAogICAgICAgICAgeG1sbGludCAtLWh0bWwgLS14cGF0aCAiLy9hW2xhc3QoKV0vdGV4dCgpICIgXAogICAgICAgICAgICA8KGN1cmwgLXNMICJodHRwczovL3B5cGkub3JnL3NpbXBsZS8kTElCLyIpIHwgXAogICAgICAgICAgICBncmVwIC1QbyAiKFxkK1wuKStcZCtcdyoiKQogICAgICAgICAgaWYgWyAiJF9MSUJfTEFTVF9QWVBJX1ZFUlNJT04iICE9ICIkX0xJQl9MT0NBTF9WRVJTSU9OIiBdOyB0aGVuCiAgICAgICAgICAgIGlmIFsgIiRfTElCX0xPQ0FMX1ZFUlNJT04iICE9ICIiIF07IHRoZW4KICAgICAgICAgICAgICBwcmludGYgIiAtPiAiCiAgICAgICAgICAgIGZpOwogICAgICAgICAgICBwcmludGYgInYlcykuLi4iICIkX0xJQl9MQVNUX1BZUElfVkVSU0lPTiIKICAgICAgICAgICAgX2xpYl9lcXVhbF92ZXJzaW9uPSIkTElCPT0kX0xJQl9MQVNUX1BZUElfVkVSU0lPTiIKICAgICAgICAgICAgc3VkbyAtSCAiJFBZM19CSU5BUllfRklMRVBBVEgiIC1tIHBpcCBpbnN0YWxsIC1VIC1xcSAiJF9saWJfZXF1YWxfdmVyc2lvbiIKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgcHJpbnRmICIpIgogICAgICAgICAgZmk7CiAgICAgIGZpOwogICAgICBwcmludGYgIiBcZVs5Mm1ceEUyXHg5Q1x4OTRcZVszOW1cbiIKICAgIGRvbmUKICBmaTsKfQpmdW5jdGlvbiBtYWluIHsKICBwcmludFByZXBlbmRlZFN0ZG91dAogIHByaW50ZiAiJXNcbiIgIiRfTVNHX1NFVFRJTkdfVVBfUFkzX0VDT1NZU1RFTSIKICBpbnN0YWxsTWFpblB5dGhvbjNBcHRQYWNrYWdlCiAgZGlzY292ZXJJbnN0YWxsYXRpb25BcHRQYWNrYWdlcwogIGluc3RhbGxQeXRob25BZGRpdGlvbmFsQXB0UGFja2FnZXMKICBjb25maWd1cmVQSVAKICB1cGdyYWRlR2xvYmFsTGlicmFyaWVzCn0KaWYgW1sgJF8gPSAkMCBdXTsgdGhlbgogIG1haW4KZmk7CmlmIFsgIiQoY29tbWFuZCAtdiBkZWJjb25mLWdldC1zZWxlY3Rpb25zKSIgIT0gIiIgXTsgdGhlbgogIHN1ZG8gc2ggLWMgImVjaG8gJ2RlYmNvbmYgZGViY29uZi9mcm9udGVuZCBzZWxlY3QgJF9PUklHSU5BTF9ERUJDT05GX0ZST05URU5EJyB8IGRlYmNvbmYtc2V0LXNlbGVjdGlvbnMiCmZpOwo=' | base64 -d)
