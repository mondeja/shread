#!/bin/bash
source <(printf 'IyEvYmluL2Jhc2gKIyAtKi0gRU5DT0RJTkc6IFVURi04IC0qLQpfTVNHX0VYRUNVVEVEX0FTX1NVUEVSVVNFUj0iVGhpcyBzY3JpcHQgbmVlZHMgdG8gYmUgZXhlY3V0ZWQgYXMgc3VwZXJ1c2VyLiIKX01TR19VUkw9IlVSTCIKX01TR19FUlJPUj0iRXJyb3IiCl9NU0dfRVJST1JfQ09ERT0iRXJyb3IgY29kZSIKX01TR19OT1RfRk9VTkQ9Ik5vdCBmb3VuZCIKX01TR19FUlJPUl9SRVRSSUVWSU5HX0dEUklWRV9SRUxFQVNFUz0iQW4gZXJyb3IgaGFwcGVuIHJldHJpZXZpbmcgR29vZ2xlIERyaXZlIHJlbGVhc2VzIGluZm9ybWF0aW9uIGZyb20gR2l0aHViIEFQSS4iCl9NU0dfRVJST1JfUEFSU0lOR19QRU5VTFRJTUFURV9HRFJJVkVfUkVMRUFTRVNfVkVSU0lPTj0iQW4gZXJyb3IgaGFwcGVuIHBhcnNpbmcgdGhlIHBlbnVsdGltYXRlIEdvb2dsZSBEcml2ZSByZWxlYXNlIHZlcnNpb24gZnJvbSBHaXRodWIgQVBJLiIKX01TR19FUlJPUl9SRVRSSUVWSU5HX0xBU1RfR0RSSVZFX1JFTEVBU0VfVkVSU0lPTj0iQW4gZXJyb3IgaGFwcGVuIHJldHJpZXZpbmcgbGFzdCBHb29nbGUgRHJpdmUgcmVsZWFzZSB2ZXJzaW9uLiIKX01TR19FUlJPUl9ET1dOTE9BRElOR19HRFJJVkU9IkFuIGVycm9yIGhhcHBlbiBkb3dubG9hZGluZyBHb29nbGUgRHJpdmUiCl9NU0dfQ0hFQ0tJTkdfR0RSSVZFX0NMSUVOVD0iQ2hlY2tpbmcgR29vZ2xlIERyaXZlIGNsaWVudC4uLiIKX01TR19SRVRSSUVWSU5HX0xBU1RfQVZBSUxBQkxFX1ZFUlNJT049IlJldHJpZXZpbmcgbGFzdCBhdmFpbGFibGUgdmVyc2lvbi4uLiIKX01TR19ET1dOTE9BRElOR19HRFJJVkVfQ0xJRU5UPSJEb3dubG9hZGluZyBHb29nbGUgRHJpdmUgY2xpZW50Li4uIgpfTVNHX1VQREFUSU5HX0dEUklWRT0iVXBkYXRpbmcgR29vZ2xlIERyaXZlIgpfTVNHX0ZPVU5EX0dEUklWRV9JTlNUQUxMRUQ9Ikdvb2dsZSBEcml2ZSBmb3VuZCBpbnN0YWxsZWQgaW4gdGhlIHN5c3RlbSIKaWYgW1sgJCgvdXNyL2Jpbi9pZCAtdSkgLW5lIDAgXV07IHRoZW4KICBwcmludGYgIiVzXG4iICIkX01TR19FWEVDVVRFRF9BU19TVVBFUlVTRVIiID4mMgogIGV4aXQgMQpmaTsKX1BSRVBFTkRfU1RET1VUX1NUUklORz0iIgpHSVRIVUJfQVBJX0NVUkxfQVVUSD0iIgppZiBbIC1uICIkR0lUSFVCX1VTRVJOQU1FIiBdICYmIFsgLW4gIiRHSVRIVUJfVE9LRU4iIF07IHRoZW4KICBHSVRIVUJfQVBJX0NVUkxfQVVUSD0iJEdJVEhVQl9VU0VSTkFNRTokR0lUSFVCX1RPS0VOIgpmaTsKZm9yIGFyZyBpbiAiJEAiCmRvCiAgICBjYXNlICRhcmcgaW4KICAgICAgICAtLXByZXBlbmQtc3Rkb3V0KQogICAgICAgIHNoaWZ0CiAgICAgICAgX1BSRVBFTkRfU1RET1VUX1NUUklORz0kMQogICAgICAgIHNoaWZ0CiAgICAgICAgOzsKICAgIGVzYWMKZG9uZQpmdW5jdGlvbiBwcmludFByZXBlbmRlZFN0ZG91dCgpIHsKICBwcmludGYgIiVzIiAiJF9QUkVQRU5EX1NURE9VVF9TVFJJTkciCn0KZnVuY3Rpb24gaW5zdGFsbFNjcmlwdERlcGVuZGVuY2llcygpIHsKICBJTlNUQUxMQVRJT05fREVQRU5ERU5DSUVTPSgiY3VybCIgImpxIikKICBmb3IgREVQIGluICIke0lOU1RBTExBVElPTl9ERVBFTkRFTkNJRVNbQF19IjsgZG8KICAgIGlmIFtbICIkKHN1ZG8gZHBrZyAtcyAiJERFUCIgMj4gL2Rldi9udWxsIHwgZ3JlcCBTdGF0dXMpIiAhPSAiU3RhdHVzOiBpbnN0YWxsIG9rIGluc3RhbGxlZCIgXV07IHRoZW4KICAgICAgc3VkbyBhcHQtZ2V0IGluc3RhbGwgLXkgLXFxcSAiJERFUCIgPiAvZGV2L251bGwgfHwgZXhpdCAkPwogICAgZmk7CiAgZG9uZQp9Cl9HRVRfR0RSSVZFX1ZFUlNJT05fSU5ERVg9MApfR0VUX0dEUklWRV9WRVJTSU9OXzQwNF9BVFRFTVBUUz0wCl9HRVRfR0RSSVZFX1ZFUlNJT05fNDA0X01BWF9BVFRFTVBUUz0xMApmdW5jdGlvbiBjaGVja0dvb2dsZURyaXZlVmVyc2lvblRvRG93bmxvYWRFeGlzdHMoKSB7CiAgX0RPV05MT0FEX0dEUklWRV9VUkw9Imh0dHBzOi8vZ2l0aHViLmNvbS9nZHJpdmUtb3JnL2dkcml2ZS9yZWxlYXNlcy9kb3dubG9hZC8kX0dEUklWRV9MQVNURVNUX1ZFUlNJT04vZ2RyaXZlLWxpbnV4LXg2NCIKICBfRE9XTkxPQURfR0RSSVZFX1VSTF9FWElTVFM9MAogIGlmIGN1cmwgLS1vdXRwdXQgL2Rldi9udWxsIC0tc2lsZW50IC0taGVhZCAtLWZhaWwgIiRfRE9XTkxPQURfR0RSSVZFX1VSTCI7IHRoZW4KICAgIF9ET1dOTE9BRF9HRFJJVkVfVVJMX0VYSVNUUz0xCiAgZmk7Cn0KX0dFVF9HRFJJVkVfTEFURVNUX1ZFUlNJT05fQVRURU1QVFM9MApfR0VUX0dEUklWRV9MQVRFU1RfVkVSU0lPTl9NQVhfQVRURU1QVFM9NQpfR0VUX0dEUklWRV9MQVRFU1RfVkVSU0lPTl9VUkw9aHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS9yZXBvcy9nZHJpdmUtb3JnL2dkcml2ZS9yZWxlYXNlcwpmdW5jdGlvbiBnZXRHb29nbGVEcml2ZUxhdGVzdFZlcnNpb24oKSB7CiAgX0dEUklWRV9SRUxFQVNFU19JTkZPPSIkKGN1cmwgLXNMICIkR0lUSFVCX0FQSV9DVVJMX0FVVEgiICIkX0dFVF9HRFJJVkVfTEFURVNUX1ZFUlNJT05fVVJMIiAyPiYxKSIKICBfR0RSSVZFX1JFTEVBU0VTX0lORk9fTUVTU0FHRT0iJChlY2hvICIkX0dEUklWRV9SRUxFQVNFU19JTkZPIiB8IGpxIC1yICcubWVzc2FnZScgMj4mMSkiCiAgX0dEUklWRV9SRUxFQVNFU19JTkZPX01FU1NBR0VfRVhJVF9DT0RFPSQ/CiAgaWYgWyAkX0dEUklWRV9SRUxFQVNFU19JTkZPX01FU1NBR0VfRVhJVF9DT0RFIC1lcSAwIF07IHRoZW4KICAgIHByaW50ZiAiXGVbOTFtXHhFMlx4OUNceDk1XGVbMzltXG4iID4mMgogICAgcHJpbnRmICJcbiVzXG4iICIkX01TR19FUlJPUl9SRVRSSUVWSU5HX0dEUklWRV9SRUxFQVNFUyIgPiYyCiAgICBwcmludGYgIiVzOiAlc1xuIiAiJF9NU0dfVVJMIiAiJF9HRVRfR0RSSVZFX0xBVEVTVF9WRVJTSU9OX1VSTCIgPiYyCiAgICBwcmludGYgIiVzOiAlc1xuIiAiJF9NU0dfRVJST1IiICIkX0dEUklWRV9SRUxFQVNFU19JTkZPX01FU1NBR0UiID4mMgogICAgZXhpdCAkX0dEUklWRV9SRUxFQVNFU19JTkZPX01FU1NBR0VfRVhJVF9DT0RFCiAgZmk7CiAgX1BBUlNFX0dEUklWRV9MQVNURVNUX1ZFUlNJT049JCgKICAgIGVjaG8gIiRfR0RSSVZFX1JFTEVBU0VTX0lORk8iIHwgXAogICAganEgLXIgIi5bJF9HRVRfR0RSSVZFX1ZFUlNJT05fSU5ERVhdLnRhZ19uYW1lIiAyPiYxKQogIF9QQVJTRV9HRFJJVkVfTEFTVEVTVF9WRVJTSU9OX0VYSVRfQ09ERT0kPwogIGlmIFsgJF9QQVJTRV9HRFJJVkVfTEFTVEVTVF9WRVJTSU9OX0VYSVRfQ09ERSAtbmUgMCBdOyB0aGVuCiAgICBwcmludGYgIlxlWzkxbVx4RTJceDlDXHg5NVxlWzM5bVxuIiA+JjIKICAgIHByaW50ZiAiXG4lc1xuIiAiJF9NU0dfRVJST1JfUEFSU0lOR19QRU5VTFRJTUFURV9HRFJJVkVfUkVMRUFTRVNfVkVSU0lPTiIgPiYyCiAgICBwcmludGYgIiVzOiAlc1xuIiAiJF9NU0dfVVJMIiAiJF9HRVRfR0RSSVZFX0xBVEVTVF9WRVJTSU9OX1VSTCIgPiYyCiAgICBwcmludGYgIiVzOiAlc1xuIiAiJF9NU0dfRVJST1JfQ09ERSIgIiRfUEFSU0VfR0RSSVZFX0xBU1RFU1RfVkVSU0lPTl9FWElUX0NPREUiID4mMgogICAgcHJpbnRmICIlczogJXMiICIkX01TR19FUlJPUiIgIiRfUEFSU0VfR0RSSVZFX0xBU1RFU1RfVkVSU0lPTiIgPiYyCiAgICBleGl0ICRfUEFSU0VfR0RSSVZFX0xBU1RFU1RfVkVSU0lPTl9FWElUX0NPREUKICBmaTsKICBfR0RSSVZFX0xBU1RFU1RfVkVSU0lPTj0kKGVjaG8gIiRfUEFSU0VfR0RSSVZFX0xBU1RFU1RfVkVSU0lPTiIgfCBjdXQgLWQndicgLWYyIDI+JjEpCiAgX0dFVF9HRFJJVkVfTEFURVNUX1ZFUlNJT05fRVhJVF9DT0RFPSQ/CiAgaWYgWyAkX0dFVF9HRFJJVkVfTEFURVNUX1ZFUlNJT05fRVhJVF9DT0RFIC1uZSAwIF07IHRoZW4KICAgICgoX0dFVF9HRFJJVkVfTEFURVNUX1ZFUlNJT05fQVRURU1QVFMrKykpCiAgICBpZiBbICRfR0VUX0dEUklWRV9MQVRFU1RfVkVSU0lPTl9BVFRFTVBUUyAtZ2UgJF9HRVRfR0RSSVZFX0xBVEVTVF9WRVJTSU9OX01BWF9BVFRFTVBUUyBdOyB0aGVuCiAgICAgIHByaW50ZiAiXGVbOTFtXHhFMlx4OUNceDk1XGVbMzltXG4iID4mMgogICAgICBwcmludCAiXG4lc1xuIiAiJF9NU0dfRVJST1JfUkVUUklFVklOR19MQVNUX0dEUklWRV9SRUxFQVNFX1ZFUlNJT04iID4mMgogICAgICBwcmludGYgIiVzOiAlc1xuIiAiJF9NU0dfVVJMIiAiJF9HRVRfR0RSSVZFX0xBVEVTVF9WRVJTSU9OX1VSTCIgPiYyCiAgICAgIHByaW50ZiAiJXM6ICVkXG4iICIkX01TR19FUlJPUl9DT0RFIiAiJF9HRVRfR0RSSVZFX0xBVEVTVF9WRVJTSU9OX0VYSVRfQ09ERSIgPiYyCiAgICAgIHByaW50ZiAiJXM6ICVzIiAiJF9NU0dfRVJST1IiICIkX0dEUklWRV9MQVNURVNUX1ZFUlNJT04iID4mMgogICAgICBleGl0ICRfR0VUX0dEUklWRV9MQVRFU1RfVkVSU0lPTl9FWElUX0NPREUKICAgIGVsc2UKICAgICAgZ2V0R29vZ2xlRHJpdmVMYXRlc3RWZXJzaW9uCiAgICBmaTsKICBmaTsKICBjaGVja0dvb2dsZURyaXZlVmVyc2lvblRvRG93bmxvYWRFeGlzdHMKICBpZiBbICRfRE9XTkxPQURfR0RSSVZFX1VSTF9FWElTVFMgLW5lIDEgXTsgdGhlbgogICAgKChfR0VUX0dEUklWRV9WRVJTSU9OXzQwNF9BVFRFTVBUUysrKSkKICAgICgoX0dFVF9HRFJJVkVfVkVSU0lPTl9JTkRFWCsrKSkKICAgIGdldEdvb2dsZURyaXZlTGF0ZXN0VmVyc2lvbgogIGVsc2UKICAgIHByaW50ZiAiICh2JXMpIFxlWzkybVx4RTJceDlDXHg5NFxlWzM5bVxuIiAiJF9HRFJJVkVfTEFTVEVTVF9WRVJTSU9OIgogIGZpOwp9CmZ1bmN0aW9uIGRvd25sb2FkR29vZ2xlRHJpdmUoKSB7CiAgX0RPV05MT0FEX0dEUklWRV9VUkw9Imh0dHBzOi8vZ2l0aHViLmNvbS9nZHJpdmUtb3JnL2dkcml2ZS9yZWxlYXNlcy9kb3dubG9hZC8kX0dEUklWRV9MQVNURVNUX1ZFUlNJT04vZ2RyaXZlLWxpbnV4LXg2NCIKICBfRE9XTkxPQURfR0RSSVZFX09VVFBVVD0iJChzdWRvIGN1cmwgLXNMICIkX0RPV05MT0FEX0dEUklWRV9VUkwiIC1vICIkMSIgMj4mMSkiCiAgX0RPV05MT0FEX0dEUklWRV9FWElUX0NPREU9JD8KICBpZiAgWyAkX0RPV05MT0FEX0dEUklWRV9FWElUX0NPREUgLW5lIDAgXTsgdGhlbgogICAgcHJpbnRmICJcZVs5MW1ceEUyXHg5Q1x4OTVcZVszOW1cbiIgPiYyCiAgICBwcmludGYgIlxuJXMgKHYlcylcbiIgIiRfTVNHX0VSUk9SX0RPV05MT0FESU5HX0dEUklWRSIgIiRfR0RSSVZFX0xBU1RFU1RfVkVSU0lPTiIgPiYyCiAgICBwcmludGYgIiVzOiAlc1xuIiAiJF9NU0dfVVJMIiAiJF9ET1dOTE9BRF9HRFJJVkVfVVJMIiA+JjIKICAgIHByaW50ZiAiJXM6ICVzXG4iICIkX01TR19FUlJPUiIgIiRfRE9XTkxPQURfR0RSSVZFX09VVFBVVCIgPiYyCiAgICBleGl0ICRfRE9XTkxPQURfR0RSSVZFX0VYSVRfQ09ERQogIGZpOwogIF9HRFJJVkVfQklOQVJZX0NPTlRFTlQ9IiQoc3VkbyBjYXQgIiQxIiB8IHRyIC1kICdcMCcpIgogIGlmIFsgIiRfR0RSSVZFX0JJTkFSWV9DT05URU5UIiA9ICJOb3QgRm91bmQiIF07IHRoZW4KICAgIGlmIFsgJF9HRVRfR0RSSVZFX1ZFUlNJT05fNDA0X0FUVEVNUFRTIC1nZSAkX0dFVF9HRFJJVkVfVkVSU0lPTl80MDRfTUFYX0FUVEVNUFRTIF07IHRoZW4KICAgICAgc3VkbyBybSAtZiAiJDEiCiAgICAgIHByaW50ZiAiXGVbOTFtXHhFMlx4OUNceDk1XGVbMzltXG4iID4mMgogICAgICBwcmludGYgIlxuJXMgKHYlcylcbiIgIiRfTVNHX0VSUk9SX0RPV05MT0FESU5HX0dEUklWRSIgIiRfR0RSSVZFX0xBU1RFU1RfVkVSU0lPTiIgPiYyCiAgICAgIHByaW50ZiAiJXM6ICVzXG4iICIkX01TR19FUlJPUl9ET1dOTE9BRElOR19HRFJJVkUiICIkX0RPV05MT0FEX0dEUklWRV9VUkwiID4mMgogICAgICBwcmludGYgIiVzOiA0MDRcbiIgIiRfTVNHX0VSUk9SX0NPREUiID4mMgogICAgICBwcmludGYgIiVzOiAlc1xuIiAiJF9NU0dfRVJST1IiICIkX0dEUklWRV9CSU5BUllfQ09OVEVOVCIgPiYyCiAgICAgIGV4aXQgMQogICAgZWxzZQogICAgICBwcmludGYgIiAoJXMpIFxlWzkxbVx4RTJceDlDXHg5NVxlWzM5bVxuIiAiJF9NU0dfTk9UX0ZPVU5EIgogICAgICAoKF9HRVRfR0RSSVZFX1ZFUlNJT05fNDA0X0FUVEVNUFRTKyspKQogICAgICAoKF9HRVRfR0RSSVZFX1ZFUlNJT05fSU5ERVgrKykpCiAgICAgIGdldEdvb2dsZURyaXZlTGF0ZXN0VmVyc2lvbgogICAgICBkb3dubG9hZEdvb2dsZURyaXZlICIkMSIKICAgIGZpOwogIGZpOwogIHN1ZG8gY2htb2QgK3ggIiQxIgogIHByaW50ZiAiIFxlWzkybVx4RTJceDlDXHg5NFxlWzM5bVxuIgp9CmZ1bmN0aW9uIG1haW4oKSB7CiAgcHJpbnRQcmVwZW5kZWRTdGRvdXQKICBwcmludGYgIiVzXG4iICIkX01TR19DSEVDS0lOR19HRFJJVkVfQ0xJRU5UIgogIGluc3RhbGxTY3JpcHREZXBlbmRlbmNpZXMKICBwcmludFByZXBlbmRlZFN0ZG91dAogIHByaW50ZiAiICAlcyIgIiRfTVNHX1JFVFJJRVZJTkdfTEFTVF9BVkFJTEFCTEVfVkVSU0lPTiIKICBnZXRHb29nbGVEcml2ZUxhdGVzdFZlcnNpb24KICBfR0RSSVZFX0ZJTEVQQVRIPSQoY29tbWFuZCAtdiBnZHJpdmUpCiAgX0dEUklWRV9GSUxFUEFUSF9FWElUX0NPREU9JD8KICBpZiBbICRfR0RSSVZFX0ZJTEVQQVRIX0VYSVRfQ09ERSAtbmUgMCBdOyB0aGVuCiAgICBfR0RSSVZFX0ZJTEVQQVRIPSIiCiAgZmk7CiAgaWYgWyAiJF9HRFJJVkVfRklMRVBBVEgiID0gIiIgXTsgdGhlbgogICAgcHJpbnRQcmVwZW5kZWRTdGRvdXQKICAgIHByaW50ZiAiICAlcyAodiVzKS4uLiIgIiRfTVNHX0RPV05MT0FESU5HX0dEUklWRV9DTElFTlQiICIkX0dEUklWRV9MQVNURVNUX1ZFUlNJT04iCiAgICBkb3dubG9hZEdvb2dsZURyaXZlIC91c3IvYmluL2dkcml2ZQogIGVsc2UKICAgIF9HRFJJVkVfVkVSU0lPTl9PVVRQVVQ9JChnZHJpdmUgdmVyc2lvbiB8IGhlYWQgLW4gMSB8IGN1dCAtZCcgJyAtZjIpCiAgICBfR0RSSVZFX1ZFUlNJT05fT1VUUFVUX0VYSVRfQ09ERT0kPwogICAgaWYgWyAkX0dEUklWRV9WRVJTSU9OX09VVFBVVF9FWElUX0NPREUgLW5lIDAgXTsgdGhlbgogICAgICBzdWRvIHJtIC1mICIkKGNvbW1hbmQgLXYgZ2RyaXZlKSIKICAgICAgcHJpbnRQcmVwZW5kZWRTdGRvdXQKICAgICAgcHJpbnRmICIgICVzICh2JXMpLi4uIiAiJF9NU0dfRE9XTkxPQURJTkdfR0RSSVZFX0NMSUVOVCIgIiRfR0RSSVZFX0xBU1RFU1RfVkVSU0lPTiIKICAgICAgZG93bmxvYWRHb29nbGVEcml2ZSAvdXNyL2Jpbi9nZHJpdmUKICAgIGVsc2UKICAgICAgX0dEUklWRV9JTlNUQUxMRURfVkVSU0lPTj0kX0dEUklWRV9WRVJTSU9OX09VVFBVVAogICAgICBwcmludFByZXBlbmRlZFN0ZG91dAogICAgCXByaW50ZiAiICAlcyAodiVzKSIgIiRfTVNHX0ZPVU5EX0dEUklWRV9JTlNUQUxMRUQiICIkX0dEUklWRV9JTlNUQUxMRURfVkVSU0lPTiIKICAgICAgcHJpbnRmICIgXGVbOTJtXHhFMlx4OUNceDk0XGVbMzltXG4iCiAgICAgIGlmIFsgIiRfR0RSSVZFX0lOU1RBTExFRF9WRVJTSU9OIiAhPSAiJF9HRFJJVkVfTEFTVEVTVF9WRVJTSU9OIiBdOyB0aGVuCiAgICAgICAgcHJpbnRQcmVwZW5kZWRTdGRvdXQKICAgICAgICBwcmludGYgIiAgJXMgKHYlcyIgIiRfTVNHX1VQREFUSU5HX0dEUklWRSIgIiRfR0RSSVZFX0lOU1RBTExFRF9WRVJTSU9OIgogICAgICAgIHByaW50ZiAiIC0+IHYlcykuLi4iICIkX0dEUklWRV9MQVNURVNUX1ZFUlNJT04iCiAgICAgICAgc3VkbyBybSAtZiAkX0dEUklWRV9GSUxFUEFUSAogICAgICAgIGRvd25sb2FkR29vZ2xlRHJpdmUgJF9HRFJJVkVfRklMRVBBVEgKICAgICAgZmk7CiAgICBmaTsKICBmaTsKfQptYWluCg==' | base64 -d)
