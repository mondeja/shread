#!/bin/bash
source <(printf 'IyEvYmluL2Jhc2gKIyAtKi0gRU5DT0RJTkc6IFVURi04IC0qLQpfTVNHX0VYRUNVVEVEX0FTX1NVUEVSVVNFUj0iVGhpcyBzY3JpcHQgbmVlZHMgdG8gYmUgZXhlY3V0ZWQgYXMgc3VwZXJ1c2VyLiIKX01TR19VUkw9IlVSTCIKX01TR19FUlJPUj0iRXJyb3IiCl9NU0dfRVJST1JfQ09ERT0iRXJyb3IgY29kZSIKX01TR19OT1RfRk9VTkQ9Ik5vdCBmb3VuZCIKX01TR19FUlJPUl9SRVRSSUVWSU5HX0dEUklWRV9SRUxFQVNFUz0iQW4gZXJyb3IgaGFwcGVuIHJldHJpZXZpbmcgR29vZ2xlIERyaXZlIHJlbGVhc2VzIGluZm9ybWF0aW9uIGZyb20gR2l0aHViIEFQSS4iCl9NU0dfRVJST1JfUEFSU0lOR19QRU5VTFRJTUFURV9HRFJJVkVfUkVMRUFTRVNfVkVSU0lPTj0iQW4gZXJyb3IgaGFwcGVuIHBhcnNpbmcgdGhlIHBlbnVsdGltYXRlIEdvb2dsZSBEcml2ZSByZWxlYXNlIHZlcnNpb24gZnJvbSBHaXRodWIgQVBJLiIKX01TR19FUlJPUl9SRVRSSUVWSU5HX0xBU1RfR0RSSVZFX1JFTEVBU0VfVkVSU0lPTj0iQW4gZXJyb3IgaGFwcGVuIHJldHJpZXZpbmcgbGFzdCBHb29nbGUgRHJpdmUgcmVsZWFzZSB2ZXJzaW9uLiIKX01TR19FUlJPUl9ET1dOTE9BRElOR19HRFJJVkU9IkFuIGVycm9yIGhhcHBlbiBkb3dubG9hZGluZyBHb29nbGUgRHJpdmUiCl9NU0dfQ0hFQ0tJTkdfR0RSSVZFX0NMSUVOVD0iQ2hlY2tpbmcgR29vZ2xlIERyaXZlIGNsaWVudC4uLiIKX01TR19SRVRSSUVWSU5HX0xBU1RfQVZBSUxBQkxFX1ZFUlNJT049IlJldHJpZXZpbmcgbGFzdCBhdmFpbGFibGUgdmVyc2lvbi4uLiIKX01TR19ET1dOTE9BRElOR19HRFJJVkVfQ0xJRU5UPSJEb3dubG9hZGluZyBHb29nbGUgRHJpdmUgY2xpZW50Li4uIgpfTVNHX1VQREFUSU5HX0dEUklWRT0iVXBkYXRpbmcgR29vZ2xlIERyaXZlIgpfTVNHX0ZPVU5EX0dEUklWRV9JTlNUQUxMRUQ9Ikdvb2dsZSBEcml2ZSBmb3VuZCBpbnN0YWxsZWQgaW4gdGhlIHN5c3RlbSIKaWYgW1sgJCgvdXNyL2Jpbi9pZCAtdSkgLW5lIDAgXV07IHRoZW4KICBwcmludGYgIiVzXG4iICIkX01TR19FWEVDVVRFRF9BU19TVVBFUlVTRVIiID4mMgogIGV4aXQgMQpmaTsKSU5ERU5UX1NUUklORz0iIgpHSVRIVUJfQVBJX0NVUkxfQVVUSD0iIgppZiBbIC1uICIkR0lUSFVCX1VTRVJOQU1FIiBdICYmIFsgLW4gIiRHSVRIVUJfVE9LRU4iIF07IHRoZW4KICBHSVRIVUJfQVBJX0NVUkxfQVVUSD0iJEdJVEhVQl9VU0VSTkFNRTokR0lUSFVCX1RPS0VOIgpmaTsKZm9yIGFyZyBpbiAiJEAiOyBkbwogIGNhc2UgJGFyZyBpbgogICAgLS1pbmRlbnQpCiAgICBzaGlmdAogICAgSU5ERU5UX1NUUklORz0kMQogICAgc2hpZnQKICAgIDs7CiAgZXNhYwpkb25lCmZ1bmN0aW9uIHByaW50SW5kZW50KCkgewogIHByaW50ZiAiJXMiICIkSU5ERU5UX1NUUklORyIKfQpmdW5jdGlvbiBpbnN0YWxsU2NyaXB0RGVwZW5kZW5jaWVzKCkgewogIGlmIFsgIiQoY29tbWFuZCAtdiBwYWNtYW4pIiA9ICIiIF07IHRoZW4KICAgIFNDUklQVF9GSUxFTkFNRT0iJChiYXNlbmFtZSAiJDAiKSIKICAgIGlmIFsgIiRTQ1JJUFRfRklMRU5BTUUiID0gIm1haW4uc2giIF07IHRoZW4KICAgICAgZmlsZXBhdGg9InNyYy91bml4L18vZG93bmxvYWQvcGFjYXB0L21haW4uc2giCiAgICAgIGJhc2ggIiRmaWxlcGF0aCIgPiAvZGV2L251bGwKICAgIGVsc2UKICAgICAgdXJsPSJodHRwczovL21vbmRlamEuZ2l0aHViLmlvL3NocmVhZC91bml4L18vZG93bmxvYWQvcGFjYXB0LyRTQ1JJUFRfRklMRU5BTUUiCiAgICAgIGN1cmwgLXNMICIkdXJsIiB8IHN1ZG8gYmFzaCAtID4gL2Rldi9udWxsCiAgICBmaTsKICBmaTsKICBJTlNUQUxMQVRJT05fREVQRU5ERU5DSUVTPSgiY3VybCIgImpxIikKICBmb3IgREVQIGluICIke0lOU1RBTExBVElPTl9ERVBFTkRFTkNJRVNbQF19IjsgZG8KICAgIGlmIFtbICIkKHN1ZG8gcGFjbWFuIC1RaSAiJERFUCIgMj4gL2Rldi9udWxsIHwgZ3JlcCBTdGF0dXMpIiAhPSAiU3RhdHVzOiBpbnN0YWxsIG9rIGluc3RhbGxlZCIgXV07IHRoZW4KICAgICAgc3VkbyBwYWNtYW4gLVMgIiRERVAiID4gL2Rldi9udWxsIHx8IGV4aXQgJD8KICAgIGZpOwogIGRvbmUKfQpfR0VUX0dEUklWRV9WRVJTSU9OX0lOREVYPTAKX0dFVF9HRFJJVkVfVkVSU0lPTl80MDRfQVRURU1QVFM9MApfR0VUX0dEUklWRV9WRVJTSU9OXzQwNF9NQVhfQVRURU1QVFM9MTAKZnVuY3Rpb24gY2hlY2tHb29nbGVEcml2ZVZlcnNpb25Ub0Rvd25sb2FkRXhpc3RzKCkgewogIF9ET1dOTE9BRF9HRFJJVkVfVVJMPSJodHRwczovL2dpdGh1Yi5jb20vZ2RyaXZlLW9yZy9nZHJpdmUvcmVsZWFzZXMvZG93bmxvYWQvJF9HRFJJVkVfTEFTVEVTVF9WRVJTSU9OL2dkcml2ZS1saW51eC14NjQiCiAgX0RPV05MT0FEX0dEUklWRV9VUkxfRVhJU1RTPTAKICBpZiBjdXJsIC0tb3V0cHV0IC9kZXYvbnVsbCAtLXNpbGVudCAtLWhlYWQgLS1mYWlsICIkX0RPV05MT0FEX0dEUklWRV9VUkwiOyB0aGVuCiAgICBfRE9XTkxPQURfR0RSSVZFX1VSTF9FWElTVFM9MQogIGZpOwp9Cl9HRVRfR0RSSVZFX0xBVEVTVF9WRVJTSU9OX0FUVEVNUFRTPTAKX0dFVF9HRFJJVkVfTEFURVNUX1ZFUlNJT05fTUFYX0FUVEVNUFRTPTUKX0dFVF9HRFJJVkVfTEFURVNUX1ZFUlNJT05fVVJMPWh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvZ2RyaXZlLW9yZy9nZHJpdmUvcmVsZWFzZXMKZnVuY3Rpb24gZ2V0R29vZ2xlRHJpdmVMYXRlc3RWZXJzaW9uKCkgewogIF9HRFJJVkVfUkVMRUFTRVNfSU5GTz0iJChjdXJsIC1zTCAiJEdJVEhVQl9BUElfQ1VSTF9BVVRIIiAiJF9HRVRfR0RSSVZFX0xBVEVTVF9WRVJTSU9OX1VSTCIgMj4mMSkiCiAgX0dEUklWRV9SRUxFQVNFU19JTkZPX01FU1NBR0U9IiQoZWNobyAiJF9HRFJJVkVfUkVMRUFTRVNfSU5GTyIgfCBqcSAtciAnLm1lc3NhZ2UnIDI+JjEpIgogIF9HRFJJVkVfUkVMRUFTRVNfSU5GT19NRVNTQUdFX0VYSVRfQ09ERT0kPwogIGlmIFsgJF9HRFJJVkVfUkVMRUFTRVNfSU5GT19NRVNTQUdFX0VYSVRfQ09ERSAtZXEgMCBdOyB0aGVuCiAgICBwcmludGYgIlxlWzkxbVx4RTJceDlDXHg5NVxlWzM5bVxuIiA+JjIKICAgIHByaW50ZiAiXG4lc1xuIiAiJF9NU0dfRVJST1JfUkVUUklFVklOR19HRFJJVkVfUkVMRUFTRVMiID4mMgogICAgcHJpbnRmICIlczogJXNcbiIgIiRfTVNHX1VSTCIgIiRfR0VUX0dEUklWRV9MQVRFU1RfVkVSU0lPTl9VUkwiID4mMgogICAgcHJpbnRmICIlczogJXNcbiIgIiRfTVNHX0VSUk9SIiAiJF9HRFJJVkVfUkVMRUFTRVNfSU5GT19NRVNTQUdFIiA+JjIKICAgIGV4aXQgJF9HRFJJVkVfUkVMRUFTRVNfSU5GT19NRVNTQUdFX0VYSVRfQ09ERQogIGZpOwogIF9QQVJTRV9HRFJJVkVfTEFTVEVTVF9WRVJTSU9OPSQoCiAgICBlY2hvICIkX0dEUklWRV9SRUxFQVNFU19JTkZPIiB8IFwKICAgIGpxIC1yICIuWyRfR0VUX0dEUklWRV9WRVJTSU9OX0lOREVYXS50YWdfbmFtZSIgMj4mMSkKICBfUEFSU0VfR0RSSVZFX0xBU1RFU1RfVkVSU0lPTl9FWElUX0NPREU9JD8KICBpZiBbICRfUEFSU0VfR0RSSVZFX0xBU1RFU1RfVkVSU0lPTl9FWElUX0NPREUgLW5lIDAgXTsgdGhlbgogICAgcHJpbnRmICJcZVs5MW1ceEUyXHg5Q1x4OTVcZVszOW1cbiIgPiYyCiAgICBwcmludGYgIlxuJXNcbiIgIiRfTVNHX0VSUk9SX1BBUlNJTkdfUEVOVUxUSU1BVEVfR0RSSVZFX1JFTEVBU0VTX1ZFUlNJT04iID4mMgogICAgcHJpbnRmICIlczogJXNcbiIgIiRfTVNHX1VSTCIgIiRfR0VUX0dEUklWRV9MQVRFU1RfVkVSU0lPTl9VUkwiID4mMgogICAgcHJpbnRmICIlczogJXNcbiIgIiRfTVNHX0VSUk9SX0NPREUiICIkX1BBUlNFX0dEUklWRV9MQVNURVNUX1ZFUlNJT05fRVhJVF9DT0RFIiA+JjIKICAgIHByaW50ZiAiJXM6ICVzIiAiJF9NU0dfRVJST1IiICIkX1BBUlNFX0dEUklWRV9MQVNURVNUX1ZFUlNJT04iID4mMgogICAgZXhpdCAkX1BBUlNFX0dEUklWRV9MQVNURVNUX1ZFUlNJT05fRVhJVF9DT0RFCiAgZmk7CiAgX0dEUklWRV9MQVNURVNUX1ZFUlNJT049JChlY2hvICIkX1BBUlNFX0dEUklWRV9MQVNURVNUX1ZFUlNJT04iIHwgY3V0IC1kJ3YnIC1mMiAyPiYxKQogIF9HRVRfR0RSSVZFX0xBVEVTVF9WRVJTSU9OX0VYSVRfQ09ERT0kPwogIGlmIFsgJF9HRVRfR0RSSVZFX0xBVEVTVF9WRVJTSU9OX0VYSVRfQ09ERSAtbmUgMCBdOyB0aGVuCiAgICAoKF9HRVRfR0RSSVZFX0xBVEVTVF9WRVJTSU9OX0FUVEVNUFRTKyspKQogICAgaWYgWyAkX0dFVF9HRFJJVkVfTEFURVNUX1ZFUlNJT05fQVRURU1QVFMgLWdlICRfR0VUX0dEUklWRV9MQVRFU1RfVkVSU0lPTl9NQVhfQVRURU1QVFMgXTsgdGhlbgogICAgICBwcmludGYgIlxlWzkxbVx4RTJceDlDXHg5NVxlWzM5bVxuIiA+JjIKICAgICAgcHJpbnQgIlxuJXNcbiIgIiRfTVNHX0VSUk9SX1JFVFJJRVZJTkdfTEFTVF9HRFJJVkVfUkVMRUFTRV9WRVJTSU9OIiA+JjIKICAgICAgcHJpbnRmICIlczogJXNcbiIgIiRfTVNHX1VSTCIgIiRfR0VUX0dEUklWRV9MQVRFU1RfVkVSU0lPTl9VUkwiID4mMgogICAgICBwcmludGYgIiVzOiAlZFxuIiAiJF9NU0dfRVJST1JfQ09ERSIgIiRfR0VUX0dEUklWRV9MQVRFU1RfVkVSU0lPTl9FWElUX0NPREUiID4mMgogICAgICBwcmludGYgIiVzOiAlcyIgIiRfTVNHX0VSUk9SIiAiJF9HRFJJVkVfTEFTVEVTVF9WRVJTSU9OIiA+JjIKICAgICAgZXhpdCAkX0dFVF9HRFJJVkVfTEFURVNUX1ZFUlNJT05fRVhJVF9DT0RFCiAgICBlbHNlCiAgICAgIGdldEdvb2dsZURyaXZlTGF0ZXN0VmVyc2lvbgogICAgZmk7CiAgZmk7CiAgY2hlY2tHb29nbGVEcml2ZVZlcnNpb25Ub0Rvd25sb2FkRXhpc3RzCiAgaWYgWyAkX0RPV05MT0FEX0dEUklWRV9VUkxfRVhJU1RTIC1uZSAxIF07IHRoZW4KICAgICgoX0dFVF9HRFJJVkVfVkVSU0lPTl80MDRfQVRURU1QVFMrKykpCiAgICAoKF9HRVRfR0RSSVZFX1ZFUlNJT05fSU5ERVgrKykpCiAgICBnZXRHb29nbGVEcml2ZUxhdGVzdFZlcnNpb24KICBlbHNlCiAgICBwcmludGYgIiAodiVzKSBcZVs5Mm1ceEUyXHg5Q1x4OTRcZVszOW1cbiIgIiRfR0RSSVZFX0xBU1RFU1RfVkVSU0lPTiIKICBmaTsKfQpmdW5jdGlvbiBkb3dubG9hZEdvb2dsZURyaXZlKCkgewogIF9ET1dOTE9BRF9HRFJJVkVfVVJMPSJodHRwczovL2dpdGh1Yi5jb20vZ2RyaXZlLW9yZy9nZHJpdmUvcmVsZWFzZXMvZG93bmxvYWQvJF9HRFJJVkVfTEFTVEVTVF9WRVJTSU9OL2dkcml2ZS1saW51eC14NjQiCiAgX0RPV05MT0FEX0dEUklWRV9PVVRQVVQ9IiQoc3VkbyBjdXJsIC1zTCAiJF9ET1dOTE9BRF9HRFJJVkVfVVJMIiAtbyAiJDEiIDI+JjEpIgogIF9ET1dOTE9BRF9HRFJJVkVfRVhJVF9DT0RFPSQ/CiAgaWYgIFsgJF9ET1dOTE9BRF9HRFJJVkVfRVhJVF9DT0RFIC1uZSAwIF07IHRoZW4KICAgIHByaW50ZiAiXGVbOTFtXHhFMlx4OUNceDk1XGVbMzltXG4iID4mMgogICAgcHJpbnRmICJcbiVzICh2JXMpXG4iICIkX01TR19FUlJPUl9ET1dOTE9BRElOR19HRFJJVkUiICIkX0dEUklWRV9MQVNURVNUX1ZFUlNJT04iID4mMgogICAgcHJpbnRmICIlczogJXNcbiIgIiRfTVNHX1VSTCIgIiRfRE9XTkxPQURfR0RSSVZFX1VSTCIgPiYyCiAgICBwcmludGYgIiVzOiAlc1xuIiAiJF9NU0dfRVJST1IiICIkX0RPV05MT0FEX0dEUklWRV9PVVRQVVQiID4mMgogICAgZXhpdCAkX0RPV05MT0FEX0dEUklWRV9FWElUX0NPREUKICBmaTsKICBfR0RSSVZFX0JJTkFSWV9DT05URU5UPSIkKHN1ZG8gY2F0ICIkMSIgfCB0ciAtZCAnXDAnKSIKICBpZiBbICIkX0dEUklWRV9CSU5BUllfQ09OVEVOVCIgPSAiTm90IEZvdW5kIiBdOyB0aGVuCiAgICBpZiBbICRfR0VUX0dEUklWRV9WRVJTSU9OXzQwNF9BVFRFTVBUUyAtZ2UgJF9HRVRfR0RSSVZFX1ZFUlNJT05fNDA0X01BWF9BVFRFTVBUUyBdOyB0aGVuCiAgICAgIHN1ZG8gcm0gLWYgIiQxIgogICAgICBwcmludGYgIlxlWzkxbVx4RTJceDlDXHg5NVxlWzM5bVxuIiA+JjIKICAgICAgcHJpbnRmICJcbiVzICh2JXMpXG4iICIkX01TR19FUlJPUl9ET1dOTE9BRElOR19HRFJJVkUiICIkX0dEUklWRV9MQVNURVNUX1ZFUlNJT04iID4mMgogICAgICBwcmludGYgIiVzOiAlc1xuIiAiJF9NU0dfRVJST1JfRE9XTkxPQURJTkdfR0RSSVZFIiAiJF9ET1dOTE9BRF9HRFJJVkVfVVJMIiA+JjIKICAgICAgcHJpbnRmICIlczogNDA0XG4iICIkX01TR19FUlJPUl9DT0RFIiA+JjIKICAgICAgcHJpbnRmICIlczogJXNcbiIgIiRfTVNHX0VSUk9SIiAiJF9HRFJJVkVfQklOQVJZX0NPTlRFTlQiID4mMgogICAgICBleGl0IDEKICAgIGVsc2UKICAgICAgcHJpbnRmICIgKCVzKSBcZVs5MW1ceEUyXHg5Q1x4OTVcZVszOW1cbiIgIiRfTVNHX05PVF9GT1VORCIKICAgICAgKChfR0VUX0dEUklWRV9WRVJTSU9OXzQwNF9BVFRFTVBUUysrKSkKICAgICAgKChfR0VUX0dEUklWRV9WRVJTSU9OX0lOREVYKyspKQogICAgICBnZXRHb29nbGVEcml2ZUxhdGVzdFZlcnNpb24KICAgICAgZG93bmxvYWRHb29nbGVEcml2ZSAiJDEiCiAgICBmaTsKICBmaTsKICBzdWRvIGNobW9kICt4ICIkMSIKICBwcmludGYgIiBcZVs5Mm1ceEUyXHg5Q1x4OTRcZVszOW1cbiIKfQpmdW5jdGlvbiBtYWluKCkgewogIHByaW50SW5kZW50CiAgcHJpbnRmICIlc1xuIiAiJF9NU0dfQ0hFQ0tJTkdfR0RSSVZFX0NMSUVOVCIKICBpbnN0YWxsU2NyaXB0RGVwZW5kZW5jaWVzCiAgcHJpbnRJbmRlbnQKICBwcmludGYgIiAgJXMiICIkX01TR19SRVRSSUVWSU5HX0xBU1RfQVZBSUxBQkxFX1ZFUlNJT04iCiAgZ2V0R29vZ2xlRHJpdmVMYXRlc3RWZXJzaW9uCiAgX0dEUklWRV9GSUxFUEFUSD0kKGNvbW1hbmQgLXYgZ2RyaXZlKQogIF9HRFJJVkVfRklMRVBBVEhfRVhJVF9DT0RFPSQ/CiAgaWYgWyAkX0dEUklWRV9GSUxFUEFUSF9FWElUX0NPREUgLW5lIDAgXTsgdGhlbgogICAgX0dEUklWRV9GSUxFUEFUSD0iIgogIGZpOwogIGlmIFsgIiRfR0RSSVZFX0ZJTEVQQVRIIiA9ICIiIF07IHRoZW4KICAgIHByaW50SW5kZW50CiAgICBwcmludGYgIiAgJXMgKHYlcykuLi4iICIkX01TR19ET1dOTE9BRElOR19HRFJJVkVfQ0xJRU5UIiAiJF9HRFJJVkVfTEFTVEVTVF9WRVJTSU9OIgogICAgZG93bmxvYWRHb29nbGVEcml2ZSAvdXNyL2Jpbi9nZHJpdmUKICBlbHNlCiAgICBfR0RSSVZFX1ZFUlNJT05fT1VUUFVUPSQoZ2RyaXZlIHZlcnNpb24gfCBoZWFkIC1uIDEgfCBjdXQgLWQnICcgLWYyKQogICAgX0dEUklWRV9WRVJTSU9OX09VVFBVVF9FWElUX0NPREU9JD8KICAgIGlmIFsgJF9HRFJJVkVfVkVSU0lPTl9PVVRQVVRfRVhJVF9DT0RFIC1uZSAwIF07IHRoZW4KICAgICAgc3VkbyBybSAtZiAiJChjb21tYW5kIC12IGdkcml2ZSkiCiAgICAgIHByaW50SW5kZW50CiAgICAgIHByaW50ZiAiICAlcyAodiVzKS4uLiIgIiRfTVNHX0RPV05MT0FESU5HX0dEUklWRV9DTElFTlQiICIkX0dEUklWRV9MQVNURVNUX1ZFUlNJT04iCiAgICAgIGRvd25sb2FkR29vZ2xlRHJpdmUgL3Vzci9iaW4vZ2RyaXZlCiAgICBlbHNlCiAgICAgIF9HRFJJVkVfSU5TVEFMTEVEX1ZFUlNJT049JF9HRFJJVkVfVkVSU0lPTl9PVVRQVVQKICAgICAgcHJpbnRJbmRlbnQKICAgIAlwcmludGYgIiAgJXMgKHYlcykiICIkX01TR19GT1VORF9HRFJJVkVfSU5TVEFMTEVEIiAiJF9HRFJJVkVfSU5TVEFMTEVEX1ZFUlNJT04iCiAgICAgIHByaW50ZiAiIFxlWzkybVx4RTJceDlDXHg5NFxlWzM5bVxuIgogICAgICBpZiBbICIkX0dEUklWRV9JTlNUQUxMRURfVkVSU0lPTiIgIT0gIiRfR0RSSVZFX0xBU1RFU1RfVkVSU0lPTiIgXTsgdGhlbgogICAgICAgIHByaW50SW5kZW50CiAgICAgICAgcHJpbnRmICIgICVzICh2JXMiICIkX01TR19VUERBVElOR19HRFJJVkUiICIkX0dEUklWRV9JTlNUQUxMRURfVkVSU0lPTiIKICAgICAgICBwcmludGYgIiAtPiB2JXMpLi4uIiAiJF9HRFJJVkVfTEFTVEVTVF9WRVJTSU9OIgogICAgICAgIHN1ZG8gcm0gLWYgJF9HRFJJVkVfRklMRVBBVEgKICAgICAgICBkb3dubG9hZEdvb2dsZURyaXZlICRfR0RSSVZFX0ZJTEVQQVRICiAgICAgIGZpOwogICAgZmk7CiAgZmk7Cn0KbWFpbgo=' | base64 -d)
